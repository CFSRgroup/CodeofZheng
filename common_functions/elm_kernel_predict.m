function [TestingTime, Predict] = elm_kernel_predict(Testdata, Traindata, ELM_Kernel_Model) 
 
 
% Usage: elm(TrainingData_File, TestingData_File, Elm_Type, NumberofHiddenNeurons, ActivationFunction) 
% OR:    [TrainingTime, TestingTime, TrainingAccuracy, TestingAccuracy] = elm(TrainingData_File, TestingData_File, Elm_Type, NumberofHiddenNeurons, ActivationFunction) 
% 
% Input: 
% TrainingData_File           - Filename of training data set 
% TestingData_File            - Filename of testing data set 
% Elm_Type                    - 0 for regression; 1 for (both binary and multi-classes) classification 
% Regularization_coefficient  - Regularization coefficient C 
% Kernel_type                 - Type of Kernels: 
%                                   'RBF_kernel' for RBF Kernel 
%                                   'lin_kernel' for Linear Kernel 
%                                   'poly_kernel' for Polynomial Kernel 
%                                   'wav_kernel' for Wavelet Kernel 
%Kernel_para                  - A number or vector of Kernel Parameters. eg. 1, [0.1,10]... 
% Output:  
% TrainingTime                - Time (seconds) spent on training ELM 
% TestingTime                 - Time (seconds) spent on predicting ALL testing data 
% TrainingAccuracy            - Training accuracy:  
%                               RMSE for regression or correct classification rate for classification 
% TestingAccuracy             - Testing accuracy:  
%                               RMSE for regression or correct classification rate for classification 
% 
% MULTI-CLASSE CLASSIFICATION: NUMBER OF OUTPUT NEURONS WILL BE AUTOMATICALLY SET EQUAL TO NUMBER OF CLASSES 
% FOR EXAMPLE, if there are 7 classes in all, there will have 7 output 
% neurons; neuron 5 has the highest output means input belongs to 5-th class 
% 
% Sample1 regression: [TrainingTime, TestingTime, TrainingAccuracy, TestingAccuracy] = elm_kernel('sinc_train', 'sinc_test', 0, 1, ''RBF_kernel',100) 
% Sample2 classification: elm_kernel('diabetes_train', 'diabetes_test', 1, 1, 'RBF_kernel',100) 
% 
    %%%%    Authors:    MR HONG-MING ZHOU AND DR GUANG-BIN HUANG 
    %%%%    NANYANG TECHNOLOGICAL UNIVERSITY, SINGAPORE 
    %%%%    EMAIL:      EGBHUANG@NTU.EDU.SG; GBHUANG@IEEE.ORG 
    %%%%    WEBSITE:    http://www.ntu.edu.sg/eee/icis/cv/egbhuang.htm 
    %%%%    DATE:       MARCH 2012 
 
%%%%%%%%%%% Load Model 
OutputWeight = ELM_Kernel_Model{1, 1}; 
Kernel_type = ELM_Kernel_Model{2, 1}; 
Kernel_para = ELM_Kernel_Model{3, 1}; 
 
%%%%%%%%%%% Calculate the output of testing input 
tic; 
Omega_test = kernel_matrix(Traindata, Kernel_type, Kernel_para, Testdata); 
Y = (Omega_test' * OutputWeight)';                            %   TY: the actual output of the testing data 
Predict = vec2ind(Y); 
TestingTime=toc 
     
     
%%%%%%%%%%%%%%%%%% Kernel Matrix %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
     
function omega = kernel_matrix(Xtrain,kernel_type, kernel_pars,Xt) 
 
nb_data = size(Xtrain,1); 
 
if strcmp(kernel_type,'RBF_kernel'), 
    if nargin<4, 
        XXh = sum(Xtrain.^2,2)*ones(1,nb_data); 
        omega = XXh+XXh'-2*(Xtrain*Xtrain'); 
        omega = exp(-omega./kernel_pars(1)); 
    else 
        XXh1 = sum(Xtrain.^2,2)*ones(1,size(Xt,1)); 
        XXh2 = sum(Xt.^2,2)*ones(1,nb_data); 
        omega = XXh1+XXh2' - 2*Xtrain*Xt'; 
        omega = exp(-omega./kernel_pars(1)); 
    end 
     
elseif strcmp(kernel_type,'lin_kernel') 
    if nargin<4, 
        omega = Xtrain*Xtrain'; 
    else 
        omega = Xtrain*Xt'; 
    end 
     
elseif strcmp(kernel_type,'poly_kernel') 
    if nargin<4, 
        omega = (Xtrain*Xtrain'+kernel_pars(1)).^kernel_pars(2); 
    else 
        omega = (Xtrain*Xt'+kernel_pars(1)).^kernel_pars(2); 
    end 
     
elseif strcmp(kernel_type,'wav_kernel') 
    if nargin<4, 
        XXh = sum(Xtrain.^2,2)*ones(1,nb_data); 
        omega = XXh+XXh'-2*(Xtrain*Xtrain'); 
         
        XXh1 = sum(Xtrain,2)*ones(1,nb_data); 
        omega1 = XXh1-XXh1'; 
        omega = cos(kernel_pars(3)*omega1./kernel_pars(2)).*exp(-omega./kernel_pars(1)); 
         
    else 
        XXh1 = sum(Xtrain.^2,2)*ones(1,size(Xt,1)); 
        XXh2 = sum(Xt.^2,2)*ones(1,nb_data); 
        omega = XXh1+XXh2' - 2*(Xtrain*Xt'); 
         
        XXh11 = sum(Xtrain,2)*ones(1,size(Xt,1)); 
        XXh22 = sum(Xt,2)*ones(1,nb_data); 
        omega1 = XXh11-XXh22'; 
         
        omega = cos(kernel_pars(3)*omega1./kernel_pars(2)).*exp(-omega./kernel_pars(1)); 
    end 
end 